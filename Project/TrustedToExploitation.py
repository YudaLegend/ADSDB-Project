import duckdb
import pandas as pd


def connectToDatabases():

    # Specify the path where DuckDB will store the databases
    db_path = './Project/Trusted Zone/trusted_zone.duckdb'
    db_path1 = './Project/Exploitation Zone/exploitation_zone.duckdb'

    # Connect to the DuckDB database
    con = duckdb.connect(database=db_path, read_only=False)

    # Create a table to store the trusted zone data
    excon = duckdb.connect("exploitation_zone.duckdb")

    return excon, con


def mergeTables(con, excon):
    steam_game_info = con.execute("SELECT * FROM steam_game_info").df()
    steam_spy = con.execute("SELECT * FROM steam_spy").df()
    steam_players = con.execute("SELECT * FROM steam_players").df()

    merge1 = pd.merge(steam_game_info, steam_spy, left_on='steam_appid', right_on='appid', how='inner')
    merge2 = pd.merge(merge1, steam_players, left_on='steam_appid', right_on='app_id', how='inner')

    merge2 = merge2[merge2["type"] == "game"]

    excon.execute("CREATE TABLE IF NOT EXISTS steam_games AS SELECT * FROM merge2")
